<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Windows 11 Wi-Fi TEAP XML Generator</title>
<style>
  /* General dark mode */
  body {
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    padding: 20px;
    max-width: 650px;
    background-color: #121212;
    color: #e0e0e0;
  }

  h2 {
    color: #fff;
  }

  label {
    display: block;
    margin-top: 15px;
    font-weight: bold;
    color: #ccc;
  }

  input, textarea, button {
    padding: 10px;
    margin-top: 5px;
    border-radius: 6px;
    border: none;
    font-size: 1em;
    outline: none;
  }

  input {
    width: 100%;
    background-color: #1e1e1e;
    color: #e0e0e0;
    border: 1px solid #333;
  }

  input::placeholder {
    color: #888;
  }

  textarea {
    width: 100%;
    height: 300px;
    background-color: #1e1e1e;
    color: #e0e0e0;
    border: 1px solid #333;
    resize: vertical;
  }

  .button-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 10px;
  }

  .button-group button {
    flex: 1;
    padding: 8px;
    font-size: 0.95em;
    cursor: pointer;
    background-color: #2979ff;
    color: #fff;
    transition: background 0.2s;
  }

  .button-group button:hover {
    background-color: #5393ff;
  }

  small {
    color: #aaa;
  }

  #toast {
    visibility: hidden;
    min-width: 220px;
    margin-left: -110px;
    background-color: #333;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 10px 15px;
    position: fixed;
    z-index: 1;
    left: 50%;
    bottom: 30px;
    font-size: 0.9em;
  }

  #toast.show {
    visibility: visible;
    animation: fadein 0.3s, fadeout 0.3s 2s;
  }

  @keyframes fadein {
    from {bottom: 0; opacity: 0;}
    to {bottom: 30px; opacity: 1;}
  }

  @keyframes fadeout {
    from {bottom: 30px; opacity: 1;}
    to {bottom: 0; opacity: 0;}
  }

  /* Optional: subtle hover for file inputs */
  input[type="file"] {
    background-color: #1e1e1e;
    border: 1px solid #555;
    color: #e0e0e0;
  }

</style>
</head>
<body>

<h2>Windows 11 Wi-Fi TEAP XML Generator</h2>

<label>SSID Name</label>
<input id="ssid" type="text" placeholder="e.g. CrispyFi">

<label>Authentication Server Common Name</label>
<input id="servercn" type="text" placeholder="e.g. auth.mist.com">

<label>Root CA Certificate Upload</label>
<input type="file" id="rootCert" accept=".cer,.crt,.pem,.der">
<small>Upload certificate to auto-calculate thumbprint</small>

<label>Client Issuing CA Certificate Upload</label>
<input type="file" id="issuerCert" accept=".cer,.crt,.pem,.der">
<small>Upload certificate to auto-calculate thumbprint</small>

<div class="button-group">
  <button onclick="generateXML()">Generate XML</button>
  <button onclick="downloadXML()">Download XML</button>
  <button onclick="copyXML()">Copy to Clipboard</button>
</div>

<textarea id="output" placeholder="Generated XML will appear here..."></textarea>
<div id="toast">Copied to clipboard!</div>

<script>
  const template = `<?xml version="1.0"?>
<WLANProfile xmlns="http://www.microsoft.com/networking/WLAN/profile/v1">
  <name>{{SSID_NAME}}</name>
  <SSIDConfig>
    <SSID>
      <hex>{{SSID_HEX}}</hex>
      <name>{{SSID_NAME}}</name>
    </SSID>
    <nonBroadcast>false</nonBroadcast>
  </SSIDConfig>
  <connectionType>ESS</connectionType>
  <connectionMode>auto</connectionMode>
  <autoSwitch>false</autoSwitch>
  <MSM>
    <security>
      <authEncryption>
        <authentication>WPA2</authentication>
        <encryption>AES</encryption>
        <useOneX>true</useOneX>
      </authEncryption>
      <PMKCacheMode>enabled</PMKCacheMode>
      <PMKCacheTTL>720</PMKCacheTTL>
      <PMKCacheSize>128</PMKCacheSize>
      <preAuthMode>disabled</preAuthMode>
      <OneX xmlns="http://www.microsoft.com/networking/OneX/v1">
        <cacheUserData>true</cacheUserData>
        <authMode>machineOrUser</authMode>
        <EAPConfig><EapHostConfig xmlns="http://www.microsoft.com/provisioning/EapHostConfig"><EapMethod><Type xmlns="http://www.microsoft.com/provisioning/EapCommon">55</Type><VendorId xmlns="http://www.microsoft.com/provisioning/EapCommon">0</VendorId><VendorType xmlns="http://www.microsoft.com/provisioning/EapCommon">0</VendorType><AuthorId xmlns="http://www.microsoft.com/provisioning/EapCommon">311</AuthorId></EapMethod><Config xmlns="http://www.microsoft.com/provisioning/EapHostConfig"><EapTeap xmlns="http://www.microsoft.com/provisioning/EapTeapConnectionPropertiesV1"><ServerValidation><ServerNames>{{AUTH_SERVER_CN}}</ServerNames><TrustedRootCAHash>{{ROOT_CA_HASH_NOSPACES}}</TrustedRootCAHash><DisablePrompt>true</DisablePrompt><DownloadTrustedServerRoot>false</DownloadTrustedServerRoot></ServerValidation><Phase2Authentication><InnerMethodConfig><EapHostConfig xmlns="http://www.microsoft.com/provisioning/EapHostConfig"><EapMethod><Type xmlns="http://www.microsoft.com/provisioning/EapCommon">13</Type><VendorId xmlns="http://www.microsoft.com/provisioning/EapCommon">0</VendorId><VendorType xmlns="http://www.microsoft.com/provisioning/EapCommon">0</VendorType><AuthorId xmlns="http://www.microsoft.com/provisioning/EapCommon">0</AuthorId></EapMethod><Config xmlns="http://www.microsoft.com/provisioning/EapHostConfig"><Eap xmlns="http://www.microsoft.com/provisioning/BaseEapConnectionPropertiesV1"><Type>13</Type><EapType xmlns="http://www.microsoft.com/provisioning/EapTlsConnectionPropertiesV1"><CredentialsSource><CertificateStore><SimpleCertSelection>true</SimpleCertSelection></CertificateStore></CredentialsSource><ServerValidation><DisableUserPromptForServerValidation>true</DisableUserPromptForServerValidation><ServerNames>{{AUTH_SERVER_CN}}</ServerNames><TrustedRootCA>{{ROOT_CA_THUMBPRINT}} </TrustedRootCA></ServerValidation><DifferentUsername>false</DifferentUsername><PerformServerValidation xmlns="http://www.microsoft.com/provisioning/EapTlsConnectionPropertiesV2">true</PerformServerValidation><AcceptServerName xmlns="http://www.microsoft.com/provisioning/EapTlsConnectionPropertiesV2">true</AcceptServerName><TLSExtensions xmlns="http://www.microsoft.com/provisioning/EapTlsConnectionPropertiesV2"><FilteringInfo xmlns="http://www.microsoft.com/provisioning/EapTlsConnectionPropertiesV3"><CAHashList Enabled="true"><IssuerHash>{{CLIENT_ISSUER_CA_THUMBPRINT}} </IssuerHash></CAHashList><ClientAuthEKUList Enabled="true"/></FilteringInfo></TLSExtensions></EapType></Eap></Config></EapHostConfig></InnerMethodConfig><InnerMethodConfig><EapHostConfig xmlns="http://www.microsoft.com/provisioning/EapHostConfig"><EapMethod><Type xmlns="http://www.microsoft.com/provisioning/EapCommon">13</Type><VendorId xmlns="http://www.microsoft.com/provisioning/EapCommon">0</VendorId><VendorType xmlns="http://www.microsoft.com/provisioning/EapCommon">0</VendorType><AuthorId xmlns="http://www.microsoft.com/provisioning/EapCommon">0</AuthorId></EapMethod><Config xmlns="http://www.microsoft.com/provisioning/EapHostConfig"><Eap xmlns="http://www.microsoft.com/provisioning/BaseEapConnectionPropertiesV1"><Type>13</Type><EapType xmlns="http://www.microsoft.com/provisioning/EapTlsConnectionPropertiesV1"><CredentialsSource><CertificateStore><SimpleCertSelection>true</SimpleCertSelection></CertificateStore></CredentialsSource><ServerValidation><DisableUserPromptForServerValidation>true</DisableUserPromptForServerValidation><ServerNames>{{AUTH_SERVER_CN}}</ServerNames><TrustedRootCA>{{ROOT_CA_THUMBPRINT}} </TrustedRootCA></ServerValidation><DifferentUsername>false</DifferentUsername><PerformServerValidation xmlns="http://www.microsoft.com/provisioning/EapTlsConnectionPropertiesV2">true</PerformServerValidation><AcceptServerName xmlns="http://www.microsoft.com/provisioning/EapTlsConnectionPropertiesV2">true</AcceptServerName><TLSExtensions xmlns="http://www.microsoft.com/provisioning/EapTlsConnectionPropertiesV2"><FilteringInfo xmlns="http://www.microsoft.com/provisioning/EapTlsConnectionPropertiesV3"><CAHashList Enabled="true"><IssuerHash>{{CLIENT_ISSUER_CA_THUMBPRINT}} </IssuerHash></CAHashList><ClientAuthEKUList Enabled="true"/></FilteringInfo></TLSExtensions></EapType></Eap></Config></EapHostConfig></InnerMethodConfig></Phase2Authentication><Phase1Identity><IdentityPrivacy>true</IdentityPrivacy><AnonymousIdentity>anonymous</AnonymousIdentity></Phase1Identity></EapTeap></Config></EapHostConfig></EAPConfig>
      </OneX>
    </security>
  </MSM>
</WLANProfile>`;

function formatThumbprint(bytes, stripLeadingZeros = false) {
  return Array.from(bytes)
    .map(b => {
      const h = b.toString(16).padStart(2, '0');
      return stripLeadingZeros ? h.replace(/^0+/, '') || '0' : h;
    })
    .join(' ');
}

async function getThumbprint(file, stripLeadingZeros = false) {
  let buffer = await file.arrayBuffer();
  let bytes = new Uint8Array(buffer);
  const text = new TextDecoder().decode(bytes);

  if (text.includes("BEGIN CERTIFICATE")) {
    const base64 = text.replace(/-----.*?CERTIFICATE-----/g, "").replace(/\s+/g, "");
    const raw = atob(base64);
    bytes = new Uint8Array(raw.length);
    for (let i = 0; i < raw.length; i++) bytes[i] = raw.charCodeAt(i);
    buffer = bytes.buffer;
  }

  const hashBuffer = await crypto.subtle.digest("SHA-1", buffer);
  return formatThumbprint(new Uint8Array(hashBuffer), stripLeadingZeros);
}

function getCNFromCert(file) {
  return new Promise(async resolve => {
    let buffer = await file.arrayBuffer();
    const text = new TextDecoder().decode(buffer);
    const match = text.match(/CN=([^,\n]+)/i);
    resolve(match ? match[1] : "Unknown");
  });
}

function ssidToHex(ssid) {
  return Array.from(ssid)
    .map(c => c.charCodeAt(0).toString(16).padStart(2,'0'))
    .join('')
    .toUpperCase();
}

async function handleRootCert(e) {
  const file = e.target.files[0]; 
  if(!file) return;

  const thumbNoZeros = await getThumbprint(file, true);
  const thumbNormal = await getThumbprint(file, false);
  const cn = await getCNFromCert(file);

  e.target.dataset.nospaces = thumbNoZeros;
  e.target.dataset.thumbprint = thumbNormal;

  document.getElementById("rootCertInfo").innerText = `CN: ${cn}\nThumbprint: ${thumbNormal}`;
}

async function handleIssuerCert(e) {
  const file = e.target.files[0]; 
  if(!file) return;

  const thumb = await getThumbprint(file, false);
  const cn = await getCNFromCert(file);

  document.getElementById("issuerCertInfo").innerText = `CN: ${cn}\nThumbprint: ${thumb}`;
}

document.getElementById("rootCert").addEventListener("change", handleRootCert);
document.getElementById("issuerCert").addEventListener("change", handleIssuerCert);

function showToast(msg="Copied to clipboard") {
  const toast = document.getElementById("toast");
  toast.innerText = msg;
  toast.className = "show";
  setTimeout(()=>{ toast.className = toast.className.replace("show",""); }, 2500);
}

function generateXML() {
  const ssid = document.getElementById("ssid").value;
  const serverCN = document.getElementById("servercn").value;
  const root = document.getElementById("rootCert");
  const issuer = document.getElementById("issuerCert");

  if(!ssid || !serverCN || !root.files.length || !issuer.files.length) {
    showToast("Please fill all fields and upload both certificates");
    return;
  }

  const xml = template
    .replaceAll("{{SSID_NAME}}", ssid)
    .replaceAll("{{SSID_HEX}}", ssidToHex(ssid))
    .replaceAll("{{AUTH_SERVER_CN}}", document.getElementById("servercn").value)
    .replaceAll("{{ROOT_CA_THUMBPRINT}}", root.dataset.thumbprint || "")
    .replaceAll("{{ROOT_CA_HASH_NOSPACES}}", root.dataset.nospaces || "")
    .replaceAll("{{CLIENT_ISSUER_CA_THUMBPRINT}}", document.getElementById("issuerCert").dataset.thumbprint || "");

  document.getElementById("output").value = xml+'\n';
}










function downloadXML() {
  const ssid = document.getElementById("ssid").value;
  const serverCN = document.getElementById("servercn").value;
  const root = document.getElementById("rootCert");
  const issuer = document.getElementById("issuerCert");

  if(!ssid || !serverCN || !root.files.length || !issuer.files.length) {
    showToast("Please fill all fields and upload both certificates");
    return;
  }

  const blob = new Blob([document.getElementById("output").value], {type:"application/xml"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a"); a.href = url; a.download="wifi-profile.xml"; a.click();
  URL.revokeObjectURL(url);
}

function copyXML() {
  const ssid = document.getElementById("ssid").value;
  const serverCN = document.getElementById("servercn").value;
  const root = document.getElementById("rootCert");
  const issuer = document.getElementById("issuerCert");

  if(!ssid || !serverCN || !root.files.length || !issuer.files.length) {
    showToast("Please fill all fields and upload both certificates");
    return;
  }

  const textarea = document.getElementById("output");
  textarea.select();
  textarea.setSelectionRange(0,99999);
  navigator.clipboard.writeText(textarea.value).then(()=>showToast());
}
</script>

</body>
</html>
